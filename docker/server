# syntax=docker/dockerfile:1
FROM python:3.8-alpine

WORKDIR /server

ENV FLASK_APP=app.py
ENV FLASK_RUN_HOST=0.0.0.0
ENV FLASK_ENV=production
ENV DB_URL=mongodb
ENV DB_PORT=27017
ENV FLASK_RUN_PORT=8000
ENV DB_TIMEOUT_MS=10000
ENV DIST_PATH=./dist
ENV DATA_DIR=./data

RUN apk add --no-cache --update \
    python3 python3-dev gcc \
    gfortran musl-dev \
    libffi-dev openssl-dev

RUN pip install --upgrade pip
COPY ./docker/requirements.txt requirements.txt
RUN pip install -r requirements.txt

COPY ./app/backend .
COPY ./app/frontend/bank-stats/dist ./dist

EXPOSE 8000
CMD ["flask", "run"]